<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/gui/index.js | MineRender</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Documentation for MineRender, quick, easy, interactive Minecraft renders"><meta property="og:type" content="website"><meta property="og:url" content="https://minerender.org"><meta property="og:site_name" content="MineRender"><meta property="og:title" content="MineRender"><meta property="og:image" content="https://minerender.org/img/minerender-x256.png"><meta property="og:description" content="Documentation for MineRender, quick, easy, interactive Minecraft renders"><meta property="og:author" content="inventivetalent"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="MineRender"><meta property="twitter:description" content="Documentation for MineRender, quick, easy, interactive Minecraft renders"><meta property="twitter:image" content="https://minerender.org/img/minerender-x256.png"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/InventivetalentDev/MineRender"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/renderBase.js~Render.html">Render</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadBlockState">loadBlockState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadJsonFromPath">loadJsonFromPath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadTextureAsBase64">loadTextureAsBase64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadTextureMeta">loadTextureMeta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-scaleUv">scaleUv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_ROOT">DEFAULT_ROOT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-defaultOptions">defaultOptions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#combined">combined</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/combined/index.js~CombinedRender.html">CombinedRender</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#entity">entity</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/entity/index.js~EntityRender.html">EntityRender</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#gui">gui</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gui/index.js~GuiRender.html">GuiRender</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-guiHelper">guiHelper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-guiPositions">guiPositions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#lib">lib</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-OrbitControls">OrbitControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-contour">contour</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#model">model</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/index.js~ModelRender.html">ModelRender</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ModelConverter">ModelConverter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#skin">skin</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/skin/index.js~SkinRender.html">SkinRender</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-texturePositions">texturePositions</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/gui/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import * as THREE from &quot;three&quot;;
import Render, { loadTextureAsBase64, defaultOptions, DEFAULT_ROOT } from &quot;../renderBase&quot;;
import guiPositions from &quot;./guiPositions&quot;;
import guiHelper from &quot;./guiHelper&quot;;

/**
 * @see defaultOptions
 * @property {string} [assetRoot=DEFAULT_ROOT] root to get asset files from
 */
let defOptions = {
    controls: {
        enabled: true,
        zoom: true,
        rotate: false,
        pan: true
    },
    camera: {
        type: &quot;perspective&quot;,
        x: 0,
        y: 0,
        z: 50,
        target: [0, 0, 0]
    },
    assetRoot: DEFAULT_ROOT
};

/**
 * A renderer for Minecraft GUIs
 */
class GuiRender extends Render {

    /**
     * @param {Object} [options] The options for this renderer, see {@link defaultOptions}
     * @param {string} [options.assetRoot=DEFAULT_ROOT] root to get asset files from
     *
     * @param {HTMLElement} [element=document.body] DOM Element to attach the renderer to - defaults to document.body
     * @constructor
     */
    constructor(options, element) {
        super(options, defOptions, element);

        this.renderType = &quot;GuiRender&quot;;

        this.gui = null;
        this.attached = false;
    }

    /**
     * Does the actual rendering
     *
     * @param {(string[]|Object[])} layers Array of GUI layers - either strings or objects
     * @param {string} layers[].texture path to the layer&apos;s texture (starting at assets/minecraft/textures/), e.g. &apos;/items/apple&apos;
     * @param {number} [layers[].textureScale=1] scale of the given texture, can be used to get different sized textures aligned proerly
     * @param {number[]} [layers[].uv] [x1,y1,x2,y2] array UV mapping of the texture
     * @param {number[]} [layers[].pos=[0,0]] [x,y] array position of the layer
     *
     * @param {function} [cb] Callback when rendering finished
     */
    render(layers, cb) {
        let guiRender = this;

        if (!guiRender.attached &amp;&amp; !guiRender._scene) {// Don&apos;t init scene if attached, since we already have an available scene
            super.initScene(function () {
                guiRender.element.dispatchEvent(new CustomEvent(&quot;guiRender&quot;, {detail: {gui: guiRender.gui}}));
            });

            guiRender._controls.target.set(0, 0, 0);
            guiRender._camera.lookAt(new THREE.Vector3(0, 0, 0));
        } else {
            console.log(&quot;[GuiRender] is attached - skipping scene init&quot;);
        }

        let promises = [];
        for (let i = 0; i &lt; layers.length; i++) {
            promises.push(new Promise((resolve, reject) =&gt; {
                let layer = layers[i];
                if (typeof layer === &quot;string&quot;) {
                    layer = {
                        texture: layer
                    }
                }
                if (!layer.textureScale) layer.textureScale = 1;

                loadTextureAsBase64(guiRender.options.assetRoot, &quot;minecraft&quot;, &quot;&quot;, layer.texture).then((url) =&gt; {
                    let imgDone = function (url) {
                        let texture = new THREE.TextureLoader().load(url, function () {
                            texture.magFilter = THREE.NearestFilter;
                            texture.minFilter = THREE.NearestFilter;
                            texture.anisotropy = 0;
                            texture.needsUpdate = true;

                            let material = new THREE.MeshBasicMaterial({
                                map: texture,
                                transparent: true,
                                side: THREE.DoubleSide,
                                alphaTest: 0.5
                            });

                            material.userData.layer = layer;

                            resolve(material);
                        })
                    };

                    if (!layer.uv) {
                        imgDone(url);
                    } else {
                        layer.uv = [
                            layer.uv[0] * layer.textureScale,
                            layer.uv[1] * layer.textureScale,
                            layer.uv[2] * layer.textureScale,
                            layer.uv[3] * layer.textureScale
                        ];

                        let img = new Image();
                        img.onload = function () {
                            let canvas = document.createElement(&quot;canvas&quot;);
                            canvas.width = layer.uv[2] - layer.uv[0];
                            canvas.height = layer.uv[3] - layer.uv[1];
                            let context = canvas.getContext(&quot;2d&quot;);
                            context.drawImage(img, layer.uv[0], layer.uv[1], layer.uv[2] - layer.uv[0], layer.uv[3] - layer.uv[1], 0, 0, layer.uv[2] - layer.uv[0], layer.uv[3] - layer.uv[1]);

                            imgDone(canvas.toDataURL(&quot;image/png&quot;));
                        };
                        img.crossOrigin = &quot;anonymous&quot;;
                        img.src = url;
                    }
                });
            }));
        }

        Promise.all(promises).then((materials) =&gt; {
            let planeGroup = new THREE.Object3D();

            let w = 0, h = 0;
            for (let i = 0; i &lt; materials.length; i++) {
                let material = materials[i];

                let width = material.map.image.width;
                let height = material.map.image.height;


                let uv = material.userData.layer.uv;
                if (!uv) {
                    // default to full image size if uv isn&apos;t set
                    uv = [0, 0, width, height];
                }
                // uv = [
                //     uv[0]/4,
                //     uv[1]/4,
                //     uv[2]/4,
                //     uv[3]/4
                // ];

                let uvW = (uv[2] - uv[0]) / material.userData.layer.textureScale;
                let uvH = (uv[3] - uv[1]) / material.userData.layer.textureScale;

                if (uvW &gt; w) w = uvW;
                if (uvH &gt; h) h = uvH;

                let geometry = new THREE.PlaneGeometry(uvW, uvH);
                let plane = new THREE.Mesh(geometry, material);
                plane.name = material.userData.layer.texture.toLowerCase() + (material.userData.layer.name ? &quot;_&quot; + material.userData.layer.name.toLowerCase() : &quot;&quot;);
                plane.position.set(0, 0, 0);

                plane.applyMatrix(new THREE.Matrix4().makeTranslation(uvW / 2, uvH / 2, 0));

                if (material.userData.layer.pos) {
                    plane.applyMatrix(new THREE.Matrix4().makeTranslation(material.userData.layer.pos[0], -uvH - material.userData.layer.pos[1], 0));
                } else {
                    plane.applyMatrix(new THREE.Matrix4().makeTranslation(0, -uvH, 0));
                }

                if (material.userData.layer.layer) {
                    plane.layers.set(material.userData.layer.layer);
                    guiRender._camera.layers.enable(material.userData.layer.layer);
                }


                planeGroup.add(plane);


                if (guiRender.options.showOutlines) {
                    let box = new THREE.BoxHelper(plane, 0xff0000);
                    planeGroup.add(box);

                    if (material.userData.layer.layer) {
                        box.layers.set(material.userData.layer.layer);
                    }

                }
            }

            planeGroup.applyMatrix(new THREE.Matrix4().makeTranslation(-w / 2, h / 2, 0));
            guiRender.addToScene(planeGroup);

            guiRender.gui = planeGroup;

            if (!guiRender.attached) {
                guiRender._camera.position.set(0, 0, Math.max(w, h));
                // https://stackoverflow.com/a/11278936
                guiRender._camera.fov = 2 * Math.atan(Math.max(w, h) / (2 * Math.max(w, h))) * (180 / Math.PI);
                guiRender._camera.updateProjectionMatrix();
            }

            if (typeof cb === &quot;function&quot;) cb();
        });
    };
}


window.GuiRender = GuiRender;
window.GuiRender.Positions = guiPositions;
window.GuiRender.Helper = guiHelper;

export default GuiRender;</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
